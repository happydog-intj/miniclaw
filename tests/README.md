# æµ‹è¯•æ–‡ä»¶

æœ¬ç›®å½•åŒ…å« MiniClaw é¡¹ç›®çš„æµ‹è¯•æ–‡ä»¶ã€‚

## æµ‹è¯•æ–‡ä»¶åˆ—è¡¨

### 1. test_agent.py - Agent åŠŸèƒ½å®Œæ•´æµ‹è¯•

å…¨é¢æµ‹è¯• Agent çš„æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š
- ç®€å•é—®ç­”ï¼ˆä¸ä½¿ç”¨å·¥å…·ï¼‰
- æ–‡ä»¶æ“ä½œï¼ˆä½¿ç”¨å·¥å…·ï¼‰
- ç›®å½•åˆ—è¡¨
- è‡ªå®šä¹‰ API ç«¯ç‚¹æ”¯æŒ
- è‡ªå®šä¹‰ User-Agent æ”¯æŒ

**è¿è¡Œæ–¹æ³•ï¼š**
```bash
# ä»é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
python tests/test_agent.py

# æˆ–è€…è¿›å…¥ tests ç›®å½•è¿è¡Œ
cd tests
python test_agent.py
```

**é¢„æœŸè¾“å‡ºï¼š**
```
============================================================
MiniClaw - Agent æµ‹è¯•
============================================================

ğŸ“‹ å½“å‰é…ç½®ï¼š
  æ¨¡å‹: claude-xxx
  API Base: http:xxx
  User-Agent: xxx
  å·¥ä½œç›®å½•: /path/to/workspace

ğŸ¤– åˆå§‹åŒ– Agent...

============================================================
æµ‹è¯• 1: ç®€å•é—®ç­”ï¼ˆä¸ä½¿ç”¨å·¥å…·ï¼‰
============================================================
...
âœ… æµ‹è¯• 1 é€šè¿‡

============================================================
æµ‹è¯• 2: æ–‡ä»¶æ“ä½œï¼ˆä½¿ç”¨å·¥å…·ï¼‰
============================================================
...
âœ… æµ‹è¯• 2 é€šè¿‡

============================================================
æµ‹è¯• 3: åˆ—å‡ºç›®å½•
============================================================
...
âœ… æµ‹è¯• 3 é€šè¿‡

============================================================
ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Agent å·¥ä½œæ­£å¸¸
============================================================
```

### 2. test_litellm_debug.py - LiteLLM è°ƒè¯•å·¥å…·

ç”¨äºè°ƒè¯• LiteLLM é…ç½®å’Œ API è°ƒç”¨é—®é¢˜ã€‚

**åŠŸèƒ½ï¼š**
- æ˜¾ç¤ºå½“å‰ API é…ç½®ï¼ˆkeyã€base URLã€modelï¼‰
- å¯ç”¨ LiteLLM è¯¦ç»†æ—¥å¿—
- æµ‹è¯•åŸºæœ¬çš„ LLM è°ƒç”¨

**è¿è¡Œæ–¹æ³•ï¼š**
```bash
# ä»é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
python tests/test_litellm_debug.py

# æˆ–è€…è¿›å…¥ tests ç›®å½•è¿è¡Œ
cd tests
python test_litellm_debug.py
```

**é¢„æœŸè¾“å‡ºï¼š**
```
API Key (å‰10ä¸ªå­—ç¬¦): sk-SaFXQ-o...
API Key (å®Œæ•´é•¿åº¦): 25
API Base: http://xxxx
Model: clude-xxx

å°è¯•è°ƒç”¨ LiteLLM...

âœ… æˆåŠŸ!
å“åº”: Hi! How can I help you today?
```

## é…ç½®è¦æ±‚

æµ‹è¯•éœ€è¦æ­£ç¡®é…ç½®é¡¹ç›®æ ¹ç›®å½•çš„ `.env` æ–‡ä»¶ï¼š

```env
# å¿…éœ€é…ç½®
TELEGRAM_TOKEN=your-telegram-token
ANTHROPIC_API_KEY=your-api-key  # æˆ– OPENAI_API_KEY

# å¯é€‰é…ç½®ï¼ˆç”¨äºè‡ªå®šä¹‰ç«¯ç‚¹ï¼‰
BASE_URL=http://your-custom-endpoint/v1
LLM_MODEL=your-model-name
CUSTOM_USER_AGENT=your-user-agent
```

## æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šå¯¼å…¥é”™è¯¯

**é”™è¯¯ä¿¡æ¯ï¼š**
```
ModuleNotFoundError: No module named 'agent'
```

**è§£å†³æ–¹æ³•ï¼š**
ç¡®ä¿ä»é¡¹ç›®æ ¹ç›®å½•è¿è¡Œæµ‹è¯•ï¼Œæˆ–è€…æµ‹è¯•æ–‡ä»¶å·²æ­£ç¡®è®¾ç½® `sys.path`ã€‚

### é—®é¢˜ï¼šç¯å¢ƒå˜é‡æœªåŠ è½½

**é”™è¯¯ä¿¡æ¯ï¼š**
```
ValueError: TELEGRAM_TOKEN æœªè®¾ç½®
```

**è§£å†³æ–¹æ³•ï¼š**
1. ç¡®è®¤é¡¹ç›®æ ¹ç›®å½•å­˜åœ¨ `.env` æ–‡ä»¶
2. ç¡®è®¤ `.env` æ–‡ä»¶ä¸­é…ç½®äº†å¿…éœ€çš„å˜é‡
3. æµ‹è¯•æ–‡ä»¶ä¼šè‡ªåŠ¨åŠ è½½ `../.env`

### é—®é¢˜ï¼šAPI è°ƒç”¨å¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š**
```
AuthenticationError: Invalid API key
```

**è§£å†³æ–¹æ³•ï¼š**
1. æ£€æŸ¥ API key æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥ API base URL æ˜¯å¦æ­£ç¡®
3. å¯¹äºè‡ªå®šä¹‰ç«¯ç‚¹ï¼Œç¡®è®¤æ˜¯å¦éœ€è¦ç‰¹å®šçš„ User-Agent
4. ä½¿ç”¨ `test_litellm_debug.py` è¿›è¡Œè¯¦ç»†è°ƒè¯•

## å¼€å‘æ–°æµ‹è¯•

æ·»åŠ æ–°æµ‹è¯•æ—¶ï¼Œè¯·éµå¾ªä»¥ä¸‹æ¨¡æ¿ï¼š

```python
"""æµ‹è¯•æè¿°"""
import asyncio
import sys
from pathlib import Path
from dotenv import load_dotenv

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°è·¯å¾„
sys.path.insert(0, str(Path(__file__).parent.parent))

# å¯¼å…¥é¡¹ç›®æ¨¡å—
from agent import Agent

# åŠ è½½é…ç½®
load_dotenv(Path(__file__).parent.parent / ".env")

async def test_your_feature():
    """æµ‹è¯•ä½ çš„åŠŸèƒ½"""
    # æµ‹è¯•ä»£ç 
    pass

if __name__ == "__main__":
    success = asyncio.run(test_your_feature())
    exit(0 if success else 1)
```

## æŒç»­é›†æˆ

è¿™äº›æµ‹è¯•å¯ä»¥é›†æˆåˆ° CI/CD æµç¨‹ä¸­ï¼š

```yaml
# GitHub Actions ç¤ºä¾‹
- name: Run tests
  run: |
    python tests/test_agent.py
    python tests/test_litellm_debug.py
```
